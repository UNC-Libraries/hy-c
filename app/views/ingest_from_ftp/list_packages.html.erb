<% provide :page_header do %>
  <h1><span class="glyphicon glyphicon-ok-circle"></span> Ingest from FTP</h1>
<% end %>

<div class="row">
  <div class="col-md-12">
    <div class="panel panel-default tabs">
      <ul class="nav nav-tabs" id="my_nav" role="list">
        <li<%= ' class="active"'.html_safe if @source == 'proquest' %>>
            <%= link_to 'Proquest',
              main_app.ingest_from_ftp_path(source: 'proquest'), class: "nav-link#{' active' if @source == 'proquest'}" %>
        </li>
        <li<%= ' class="active"'.html_safe if @source == 'sage' %>>
          <%= link_to 'Sage', main_app.ingest_from_ftp_path(source: 'sage'), class: "nav-link#{' active' if @source == 'sage'}" %>
        </li>
      </ul>
      <%= form_tag main_app.delete_from_ftp_path(source: @source), method: :post do %>
      <div class="panel-body">
        <h2 class="sr-only">Ingest from <%= @source %> </h2>
        <fieldset class="btn-group">
          <%= button_to 'Ingest Packages', main_app.ingest_from_ftp_path(source: @source), method: :post, class: 'btn btn-danger',  data: { confirm: 'Are you sure you want to ingest all packages?' } %>
        </fieldset>
        <fieldset class="btn-group">
          <%= link_to 'View Status of last Ingest', main_app.ingest_from_ftp_status_path(source: @source), method: :get, class: 'btn btn-default' %>
        </fieldset>
        <fieldset class="btn-group">
          <%= submit_tag 'Delete Selected Packages', class: 'btn',  data: { confirm: 'Are you sure you want to delete selected packages?' } %>
        </fieldset>
        <table class="table table-sm table-striped works-list">
          <thead>
            <tr>
              <th></th>
              <th>Package</th>
              <th>Received Date</th>
              <% if @needs_revision_flag %>
                <th>Is revision?</th>
              <% end %>
            </tr>
          </thead>
          <tbody>
            <% @package_results.each do |entry| %>
              <tr>
                <td>
                  <%= check_box_tag 'filenames_to_delete[]', entry[:filename] %>
                <td>
                  <%= entry[:filename] %>
                </td>
                <td>
                  <%= entry[:last_modified].strftime('%b %-d, %Y') %>
                </td>
                <% if @needs_revision_flag %>
                  <td>
                  <%= entry[:is_revision] %>
                </td>
                <% end %>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <% end %>
    </div>
  </div>
</div>
